<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="mudasobwa-article"  extends="mudasobwa-content-slider" attributes="apiurlprefix">
	<template>
		<style>
			:host { display: block; }
			polyfill-next-selector { content: 'font-awesome'; }
				::content font-awesome { font-size: 48px; }
			polyfill-next-selector { content: 'div.slider-content'; }
				::content div.slider-content {
					border-radius: 10px;
					-moz-border-radius: 10px;
					-webkit-border-radius: 10px;
					border: 2px solid #EEE;

					padding: 0 1em;
				}
		</style>
		<shadow></shadow>
	</template>
	<script>
		Polymer('mudasobwa-article', {
			frozen: false,
			freeze: function(frozen) {
				this.frozen = frozen;
			},
			attached: function() {
					this.super();
					var self = this;
					(function(window, undefined){
						// Bind to StateChange Event
						History.Adapter.bind(window, 'statechange', function() {
							if(!self.frozen)
								self.$.content.goto(self.apiurlprefix + History.getState().data['state']);
						});
					})(window);
			},
			articleChanged: function() {
				this.super();

				var root = this;
				while (root.parentNode) {
					root = root.parentNode;
				}

				if(this.url) {
					var currState = this.url.replace(new RegExp('^' + this.apiurlprefix), '');
					console.log("Pushing state " + currState);
					this.freeze(true);
					History.pushState({state:currState}, this.title, currState);
					this.freeze(false);
					root.title = this.title;
				}
			}

		});
	</script>
</polymer-element>
